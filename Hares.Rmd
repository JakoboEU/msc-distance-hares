---
title: "Hares"
output: html_notebook
---
```{r}
library(mrds)
library(Distance)
library(plyr)
library(knitr)
```

```{r}
hareData <- read.table(
  "data.txt",
  sep="\t", header=TRUE)
hareData$ID <- seq.int(nrow(hareData))
head(hareData)
```

Work out the regions
```{r}
hareRegions <- rename(unique(hareData[, 1:2]), c("STUDY.SITE"="Region.Label", "AREA"="Area"))
head(hareRegions)
```

Work out the samples
```{r}
hareSamples <- subset(
  rename(unique(hareData[, 1:4]), 
         c("STUDY.SITE"="Region.Label", "TRANSECT.NUMBER"="Sample.Label", "TRANSECT.LENGTH.KM"="Effort")),
  select=c("Region.Label", "Sample.Label", "Effort"))
head(hareSamples)
```

Work out the observations
```{r}
hareObservations <- subset(
  rename(hareData, c("ID"="object", "STUDY.SITE"="Region.Label", "TRANSECT.NUMBER"="Sample.Label")),
  select=c("object","Region.Label","Sample.Label"))
head(hareObservations)
```

Now create actual data
distanceFromTransect = DISTANCE.METRES * sin(ANGLE)
```{r}
hareData$distance = hareData$DISTANCE..METRES * sin(hareData$ANGLE)
data <- subset(
  rename(hareData, c("ID"="object", "CLUSTER.SIZE"="size")),
  select=c("object","size","distance"))
head(data)
```


```{r}
halfnorm.hares <- ds(data, 
                     key="hn", 
                     adjustment="cos", 
                     region.table = hareRegions, 
                     sample.table = hareSamples,
                     obs.table = hareObservations)
```

```{r}
par(mfrow=c(1,2))
plot(halfnorm.hares, main="Hares, half-normal detection function")
fit.test <- ddf.gof(halfnorm.hares$ddf)
```

```{r}
kable(halfnorm.hares$dht$individuals$summary,format="markdown")
```
```{r}
kable(halfnorm.hares$dht$individuals$D,format="markdown")
```

```{r}
AIC(halfnorm.hares)
```


```{r}
hazard.hares <- ds(data, key="hr",  adjustment="poly",
                     truncation = "20%",
                     region.table = hareRegions, 
                     sample.table = hareSamples,
                     obs.table = hareObservations)
```


```{r}
par(mfrow=c(1,2))
plot(hazard.hares, main="Hares, hazard detection function")
fit.test <- ddf.gof(hazard.hares$ddf)
```












